"""
FastAPI Dependencies
Generated by bffgen
"""

from fastapi import Header, HTTPException, Depends
from typing import Optional
import logging

from config import settings

logger = logging.getLogger(__name__)


async def get_current_user(authorization: Optional[str] = Header(None)) -> Optional[str]:
    """
    Dependency to extract and validate user from JWT token
    
    Args:
        authorization: Authorization header with Bearer token
    
    Returns:
        User ID if authenticated, None otherwise
    """
    if not authorization:
        return None
    
    try:
        # Extract token from "Bearer <token>"
        scheme, token = authorization.split()
        if scheme.lower() != "bearer":
            return None
        
        # TODO: Implement JWT validation
        # For now, returning None (unauthenticated)
        # You should implement proper JWT validation here
        return None
    
    except Exception as e:
        logger.error(f"Auth error: {e}")
        return None


async def require_auth(user: Optional[str] = Depends(get_current_user)) -> str:
    """
    Dependency that requires authentication
    
    Args:
        user: User ID from get_current_user dependency
    
    Returns:
        User ID
    
    Raises:
        HTTPException: If user is not authenticated
    """
    if not user:
        raise HTTPException(status_code=401, detail="Authentication required")
    return user

